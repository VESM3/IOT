# Tímaverkefni 4 

- Námsmat 17% af heildareinkunn
- Einstaklingsverkefni
- RPi, myndavél og vefþjónusta

### 1. RPi uppsetning (20%)

Byrjaðu á að setja SSD kortið í Pi og tengdu myndavélina í samráði við kennara. Næst tengirðu RPi við rafmagn.

:warning: Til að geta tengst RPi með SSH þá þarf fartölvan þín að vera tengd ```TskoliVESM``` þráðlausa netinu (lykilorð ```Fallegurhestur```) :warning:

Tengstu RPi með SSH með því að slá eftirfarandi inn í Terminal (PowerShell á Windows, Terminal á Apple):

```bash
ssh pi@hYXX
```

Lykilorðið er ```Verksm1dja``` (ath. 1 (einn) í stað i).

Þar sem Y er hópurinn sem þú ert í og XX númerið á SSD kortinu sem þú fékkst.

Uppfærðu svo stýrikerfið á Pi með því að gefa þessa skipun:

```bash
sudo apt update && sudo apt full-upgrade
```

Sæktu svo fulla útgáfu af python.

```bash
sudo apt install python3-full
```

#### Að tengjast RPi desktop (viðmót) frá fartölvu 

<details>
<summary>Að tengjast með RPi Connect</summary>
<br>
    
Næst þarf að virkja tvær þjónustur en það eru ```RPi Connect``` og ```VNC```.

```bash
sudo raspi-config
```

Veldu svo ```Interface Options```. Notaður örvatakkana til að færa þig upp/niður og síðan Tab takkann til að velja ```<Select>``` þar sem þú smellir að Enter.

![raspi-config-main](https://raw.githubusercontent.com/VESM3/IOT/refs/heads/main/Myndir/raspi_config_main.png)

Farðu svo í RPi Connect og veldu ```<Yes>``` og gerðu svo það sama fyrir ```VNC```

![raspi-config-interface](https://raw.githubusercontent.com/VESM3/IOT/refs/heads/main/Myndir/raspi_config_interface.png)

Að lokum velur þú svo ```<Finish>``` til að komast út úr ```raspi-config```

Virkjaðu næst RPi Connect með því að gefa eftirfarandi skipun:

```bash
rpi-connect on
```

Næst þarftu að skrá þig inn með því að gefa eftirfarandi skipu:

```bash
rpi-connect signin
```

Þá færðu slóð sem þú þarft að fara inn á með vafranum þínum.

```
Complete sign in by visiting https://connect.raspberrypi.com/verify/XXXX-XXXX
```

```bash
https://connect.raspberrypi.com/verify/XXXX-XXXX
```
Þar þarftu svo að búa þér til reikning (Raspberry Pi ID). Að lokum þarftu svo að gefa Pi-inum nafn og þá ættir þú að geta tengst honum með gluggaumhverfi með því að velja **Screen Sharing** úr **Connect via**.

Núna getur þú tengst bæði Terminal og gluggaumhverfi án þess að fartölvan þín sé tengd við TskoliVESM þráðlausa netið.

Til að tengjast þessu seinna getur þú farið inn á [þessa](https://connect.raspberrypi.com/) slóð.

</details>

<br>

<details>
<summary>Að tengjast RPi með VNC</summary>
<br>

Að keyra VNC server á Raspberry Pi leyfir þér að tengjast **RPi desktop** viðmóti þráðlaust frá fartölvu. Ath. fartölvan þarf að vera á sama wifi og RPi.

1. VNC server þarf að vera **enable** á RPi.
    ```bash
    sudo raspi-config
    ```
    Veldu svo ```Interface Options```. Notaður örvatakkana til að færa þig upp/niður og síðan Tab takkann til að velja ```<Select>``` þar sem þú smellir að Enter.
    ![raspi-config-main](https://raw.githubusercontent.com/VESM3/IOT/refs/heads/main/Myndir/raspi_config_main.png)
    Farðu svo í VNC og veldu ```<Yes>```. Að lokum velur þú svo ```<Finish>``` til að komast út úr ```raspi-config```.
1. Náðu í [VNC viewer](https://www.realvnc.com/en/connect/download/viewer/) í fartölvuna, búðu til reikning.
    1. Búðu til VNC tengingu (New Connection) í File.
       ```
       VNC Server:  hostname    # eða iptala 
       user:  pi
       lykilorð: Verksm1dja        
       ```
    1. Tvísmelltu á tenginguna, notendafnið er `pi` (ekki breyta) og lykilorð. 
1. Núna getur þú tengst RPi með fartölvunni 

</details>

<!--
#### Hugsanleg vandamál  
- Ef þú nærð ekki VNC (_eða SSH_) samband við RPi (fartölva þarf að vera á sama wifi og RPi): 
     - nota nmap í terminal: 10.201.48.0/24 -sn -Pn.
     - keyra skipunina `nslookup hostname.tskoli.vesm` til að fá `IP` töluna sem þú getur þá notað í staðinn fyrir `hostaname.tskoli.vesm`  (virkar ekki alltaf)
- SSH. Ef permission denied (publickey) á rpi. Þá hreinsa út eldra key úr tölvunni `$ ssh-keygen -R [hostname-or-IP]`
- port 22: Connection timed out. SSH lokað útaf firewall í tölvu [windows fix](https://www.windowscentral.com/how-open-port-windows-firewall) 
- Ef þú færð svartan skjá  gerðu þá eftirfarandi breytingu í skrá (með SSH tengingu á RPi): `/boot/config.txt`. Taktu commentið út (`#`) af `hdmi_force_hotplug=1`.
-->

---

### 2. RPi myndavél (40%)

#### Taka mynd með ```rpicam```

Byrjaðu á að opna terminal í gluggaumhverfinu og keyrðu eftirfarandi:

```bash
rpicam-still --output rpicam_mynd.jpg
```

Eftir smá stund opnast forskoðunargluggi og þegar hann hverfur getur þú opnað myndina með því að skrifa inn

```bash
open rpicam_mynd.jpg
```

eða með því að opna skrárkerfið og tvísmella á myndina.

[Hér](https://www.raspberrypi.com/documentation/computers/camera_software.html#rpicam-apps) má finna upplýsingar um ýmis ```rpicam``` forrit sem eru á RPi.

#### Taka mynd með python

Opnaðu Thonny á RPi og settu þennan kóða þar inn:

```python
from picamera2 import Picamera2, Preview
import time

# búa til tilvik af myndavélinni
picam2 = Picamera2()
# stillingar fyrir forskoðunina
camera_config = picam2.create_preview_configuration()
picam2.configure(camera_config)
# ræsa forskoðun
picam2.start_preview(Preview.QT)
# taka myndina
picam2.start()
time.sleep(2)
# vista myndina
picam2.capture_file("python_mynd.jpg")
# slökkva á forskoðunarglugganum
picam2.stop_preview()
```

Þessi kóði sýnir forskoðunarglugga og tekur síðan mynd. Forskoðunarglugginn krefst þess að kóðinn sé keyrður í gluggaumhverfi. Vandamálið við þetta er að sjálfgefnu myndirnar eru í mikilli upplausn (allt að 4608*2592) og RPi Zero 2 ræður ekki vel við þá stærð.

En taka þarf mynd án þess að vera með gluggaumhverfi má keyra eftirfarandi kóða **í Terminal** og af því að RPi Zero 2 er með lítið vinnsluminni og hægan örgjörva er þetta oftast besta leiðin:

```python
from picamera2 import Picamera2
import time
picam2 = Picamera2()
picam2.start()
picam2.capture_file("terminal_mynd.jpg")
```

#### Stillingar á myndatöku

Hægt er að stilla myndavélina á marga vegu t.d.:
```python
from picamera2 import Picamera2
import time
picam2 = Picamera2()
picam2.start()
with picam2.controls as controls:
        controls.Sharpness = 0.5
        controls.Saturation = 3.0
picam2.capture_file("terminal_mynd.jpg")
```

Sjá fleiri dæmi um mismunandi stillingar á myndavélinni í köflum 4, 5 og 6 í [Picamera2 Library bókinni](https://datasheets.raspberrypi.com/camera/picamera2-manual.pdf).

#### **Verkefnið**

1. Skrifaðu kóða sem tekur mynd á 5 sekúndna fresti og geymir 5 síðustu myndirnar sem teknar voru, þegar sjötta myndin er tekin á hún að skrifast yfir elstu myndina.
2. Sýndu hæfni þína í að skrifa kóða sem tekur mynd sem hefur einhverjar skemmtilegar stillingar (sjá [Picamera2 Library bókina](https://datasheets.raspberrypi.com/camera/picamera2-manual.pdf)), frjáls útfærsla (upplausn, litir, skráartegund eða annað).

<!-- Kynntu þér [Blue Dot](https://bluedot.readthedocs.io/en/latest/) og gerðu bluedot forrit sem hefur tvo takka, annar takkinn á að taka venjulega mynd en hinn takkinn á að taka mynd þar sem stillingum myndavélarinnar hefur verið breytt á einhvern skemmtilegan hátta (frjáls útfærsla). -->

---

### 3. RPi Myndgreingavefþjónusta (40%)

Myndgreiningavefþjónustur eru sniðugar til að greina hluti, andlit, liti og texta á ljósmyndum. Notaðu [Computer Vision](https://azure.microsoft.com/en-us/services/cognitive-services/computer-vision/#overview) frá Microsoft Azure til að greina ljósmynd. 

1. Myndgreining með Computer Vision (fartölva)
   1. Skráðu þig inn á [Azure](https://azureforeducation.microsoft.com/devtools) með skólanetfanginu. Veldu svo _Access student benefits_ og _signup_.
   1. Gerðu viðeigandi stillingar hjá Azure [myndband](https://www.youtube.com/watch?v=1VB_QrHm_nY&ab_channel=JieJenn) til að geta notað Computer Vision. Hér eru frekari [leiðbeiningar](https://www.pluralsight.com/guides/computer-vision-with-microsoft-azure).
   1. Notaðu VSCode og python á fartölvunni, sjá [kóðadæmi](https://github.com/VESM3/IOT/blob/main/Efni/ComputerVisionDemo.py) til að greina ljósmynd (minna en 4MB).
1. Notaðu RPi, PiCamera2 (local ljósmynd) og Computer Vision saman og birtu niðurstöður á skjá. Sjá [kóðabúta](https://github.com/Azure-Samples/cognitive-services-quickstart-code/blob/master/python/ComputerVision/ImageAnalysisQuickstart.py) úr skránni. (ekki nota `pillow` safnið)

---

## Námsmat og skil

- Skilaðu öllum kóða á Innu
  - Passaðu að þú getir útskýrt kóðann sem þú skilar fyrir kennara.
- Yfirferð á sér stað í tíma. Einkunn fyrir hvern lið: 
    - 10 lausn er vel útfærð.
    - 7.5 lausn er smávægilega ábótavant (vantar smá upp á).
    - 5 lausn er ábótavant, helmingur er vel útfærður.
    - 2.5 lausn er stórlega ábótavant, en tíma- og kóðavinna lögð í lausn.
    - 0 lausn vantar eða óunnin.
