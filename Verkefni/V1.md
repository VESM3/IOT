# Tímaverkefni 1

- Námsmat 15% af heildareinkunn
- Einstaklingsverkefni
- Viðfangsefni: NeoPixel, Servo, RFID

---

**ATH.** Ef augu eða kjálki virka ekki á hauskúpunni þarft þú að laga það. 
- [Lóðun augna](https://github.com/VESM3/IOT/blob/main/Myndir/augu.png)
- [Tengingar augna](https://github.com/VESM3/IOT/blob/main/Myndir/augu_breadboard.png)
- [Tengingar servo]()

### 1. NeoPixel (**30%**)

Uppfærðu Micropython á ESP-num þínum í nýjustu útgáfu, [leiðbeiningar](https://github.com/VESM1VS/AFANGI/blob/main/Kennsluefni/ESP_Uppsetning.md), og keyrðu halló heimur (blikk) í MicroPython. <br>
Notaðu NeoPixel fyrir bæði augun og láttu þær blikka til skiptis með mismunandi litbrigðum og birtustigi. 

**Kóðasýnidæmi:**

<details>
<summary>NeoPixel</summary>
<br>

```python

from machine import Pin
from neopixel import NeoPixel
from time import sleep_ms

neo = NeoPixel(Pin(42), 2)   #  2 x Leds

# slökktu á báðum leds
neo.fill([0, 0, 0])

# Allar NeoPixel perurnar lýsa rauðu ljósi í eina sekúndu með fill aðferð.
neo.fill([255, 0, 0])
neo.write()
sleep_ms(1000)

# LED nr 2 er lýst með grænum lit
neo[1] = [0, 255, 0]
neo.write()

```

</details>
<br>

**Til upprifjunar:** [Stafræn gildi](https://github.com/VESM1VS/AFANGI/blob/main/Kennsluefni/digital.md) og [Hliðræn gildi](https://github.com/VESM1VS/AFANGI/blob/main/Kennsluefni/analog.md)

> **Note**
> **Ekki** nota pinna; GPIO0, GPIO3, GPIO19, GPIO20, GPIO45, GPIO46. 

<!-- [`ticks_ms`](https://github.com/VESM2VT/ESP32/blob/main/kodi/ticks.md) og [sýnidæmi](https://wokwi.com/projects/390068539029210113). -->

---

### 2. Servo (**30%**)
Settu upp [þessa](https://raw.githubusercontent.com/VESM3/IOT/refs/heads/main/Myndir/servo_kjalki.png) rás á brauðbretti og MG996R servo. 

:warning: Þegar unnið er með mótora er best að nota utanaðkomandi spennugjafa fyrir þá af því að mótorar geta dregið meiri straum en ESP ræður við. Þú færð spennugjafa hjá kennara. Servo þarf 5V.

Fyrir servo mótorinn þarftu að sækja [þetta](https://github.com/pvanallen/esp32-getstarted/blob/master/examples/servo.py) klasasafn. Sjá nánar [hér](https://github.com/pvanallen/esp32-getstarted/blob/master/docs/servo.md) kóðadæmi og að uppphafstilla min og max á servo.

#### Verkefnið
1. Losaðu kjálkann með MG90S micro servo frá hauskúpunni og stilltu rétt breiddarsvið (min og max) ef þú þarft. Finndu út upphafstöðu í gráðum þegar hann er með lokaðan munn.
1. Settu kjálkann aftur í. Láttu servo opna og loka munn eins og hægt er, 5 gráður í einu, þetta á að endurtaka sig að eilífu.

---

### 3. RFID (**40%**)

Kynntu þér SPI samskipti með því að lesa þessa [grein](https://www.circuitbasics.com/basics-of-the-spi-communication-protocol) og/eða horfa á þetta [myndband](https://www.youtube.com/watch?v=ldRkXTBw9_o) og lestu þér til um [RC522 RFID](https://lastminuteengineers.com/how-rfid-works-rc522-arduino-tutorial/). 

1. Tengdu svo RC522 RFID við ESP32-S3 á brauðbretti samkvæmt þessari [mynd](https://raw.githubusercontent.com/VESM3/IOT/main/Myndir/verkefni_1_3_rfid_tenging.png): 
1. Settu svo inn eftirfarandi kóða (þú finnur mfrc522 klasasafnið [hér](https://github.com/cefn/micropython-mfrc522/blob/master/mfrc522.py)):
     ```python
     from mfrc522 import MFRC522
     from machine import Pin, SoftSPI

     sck = Pin(3) 
     mosi = Pin(7)
     miso = Pin(5) # algeng önnur nöfn: SCL og TX
     rst = 4
     nss = 9 # algeng önnur nöfn: SS, SDA, CS og RX

     # Búa til og virkja SPI tenginguna
     spi = SoftSPI(baudrate=100000, polarity=0, phase=0, sck=sck, mosi=mosi, miso=miso)
     spi.init()

     # Búa til tilvik af RFID lesarann og tengjast honum með SPI
     rfid_lesari = MFRC522(spi=spi, gpioRst=rst, gpioCs=nss)

     print("Skannaðu kort!")

     while True:
          (stada, korta_tegund) = rfid_lesari.request(rfid_lesari.REQIDL)
          if stada == rfid_lesari.OK: # ef eitthvað er til að lesa
               (stada, kortastrengur) = rfid_lesari.anticoll()
               if stada == rfid_lesari.OK:
                    # kortanúmerið er í bytearray og því gott að 
                    # breyta því í heiltölu áður en unnið er með það
                    kortanumer = int.from_bytes(kortastrengur, "big")
                    print(kortanumer)
     ```

### Verkefnið

1. Lestu *id*-ið af tveimur kortum og bættu númerunum á þeim í kóðann hér að ofan (t.d. í lista).
1. Breyttu nú forritun hér að ofan þannig að þegar þekkt kort (úr liðnum hér fyrir ofan) er lesið kemur grænt ljós á NeoPixel-ana í augunum en ef kortið er ekki þekkt kemur rautt ljós. Ljósin eiga loga í eina sekúndu (má gera með `sleep_ms`).
1. NFC (það sem þú notar til að borga með símanum) virkar eins og RFID. Þegar þú berð símann þinn upp að RFID lesaranum á munnurinn að opnast og síðan lokast.

> Nánar um [RFID og NFC](https://github.com/VESM3/IOT/wiki/RFID-og-NFC) <br>

---

## Námsmat og skil

- Skilaðu öllum kóða á Innu
  - Passaðu að þú getir útskýrt kóðann sem þú skilar fyrir kennara.
- Yfirferð á sér stað í tíma. Einkunn fyrir hvern lið: 
    - 10 lausn er vel útfærð.
    - 7.5 lausn er smávægilega ábótavant.
    - 5 lausn er ábótavant, helmingur er vel útfærður.
    - 2.5 lausn er stórlega ábótavant.
    - 0 lausn vantar eða óunnin.


